---
// Project Modal Component
---

<!-- Modal Overlay -->
<div id="projectModal" class="fixed inset-0 z-50 hidden">
  <!-- Backdrop -->
  <div 
    id="modalBackdrop" 
    class="absolute inset-0 bg-black/80 backdrop-blur-sm"
    onclick="window.closeProjectModal()"
  ></div>
  
  <!-- Modal Container -->
  <div class="absolute inset-0 overflow-y-auto">
    <div class="min-h-full flex items-center justify-center p-4">
      <div 
        id="modalContent"
        class="relative w-full max-w-6xl bg-gradient-to-br from-slate-900 to-slate-950 rounded-2xl border border-slate-700/50 shadow-2xl transform transition-all"
      >
        <!-- Close Button -->
        <button 
          onclick="window.closeProjectModal()"
          class="absolute top-4 right-4 z-10 w-10 h-10 flex items-center justify-center rounded-full bg-slate-800/80 hover:bg-slate-700 border border-slate-600/50 hover:border-slate-500 transition-all duration-300 group"
        >
          <svg class="w-5 h-5 text-slate-400 group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>

        <!-- Modal Body -->
        <div class="p-8 md:p-12">
          <!-- Project Title & Category -->
          <div class="mb-8">
            <span id="modalCategory" class="inline-block px-4 py-2 bg-blue-500/10 border border-blue-500/20 rounded-full text-blue-400 text-sm font-semibold backdrop-blur-sm mb-4"></span>
            <h2 id="modalTitle" class="text-4xl md:text-5xl font-black text-white mb-4"></h2>
            <p id="modalDescription" class="text-xl text-slate-300 leading-relaxed"></p>
          </div>

          <!-- Image Gallery -->
          <div class="mb-8">
            <div class="relative rounded-xl overflow-hidden border border-slate-700/50">
              <img 
                id="modalMainImage" 
                src="" 
                alt="Project screenshot"
                class="w-full h-auto object-cover"
              />
              
              <!-- Gallery Navigation -->
              <button 
                id="prevImageBtn"
                class="absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 flex items-center justify-center rounded-full bg-slate-900/90 hover:bg-slate-800 border border-slate-700/50 hover:border-slate-600 transition-all duration-300 group"
              >
                <svg class="w-6 h-6 text-slate-300 group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
              </button>
              
              <button 
                id="nextImageBtn"
                class="absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 flex items-center justify-center rounded-full bg-slate-900/90 hover:bg-slate-800 border border-slate-700/50 hover:border-slate-600 transition-all duration-300 group"
              >
                <svg class="w-6 h-6 text-slate-300 group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </button>

              <!-- Image Counter -->
              <div class="absolute bottom-4 right-4 px-3 py-1 bg-slate-900/90 backdrop-blur-sm rounded-full border border-slate-700/50 text-sm text-slate-300">
                <span id="currentImageIndex">1</span> / <span id="totalImages">1</span>
              </div>
            </div>

            <!-- Thumbnail Gallery -->
            <div id="thumbnailGallery" class="grid grid-cols-4 md:grid-cols-6 gap-2 mt-4"></div>
          </div>

          <!-- Tech Stack -->
          <div class="mb-8">
            <h3 class="text-2xl font-bold text-white mb-4">Tech Stack</h3>
            <div id="modalTechStack" class="flex flex-wrap gap-3"></div>
          </div>

          <!-- Long Description -->
          <div class="mb-8">
            <h3 class="text-2xl font-bold text-white mb-4">Project Details</h3>
            <div id="modalLongDescription" class="prose prose-invert prose-slate max-w-none">
              <p class="text-lg text-slate-300 leading-relaxed"></p>
            </div>
          </div>

          <!-- Action Buttons -->
          <div id="modalActions" class="flex flex-wrap gap-4"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  #projectModal {
    animation: fadeIn 0.2s ease-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  #modalContent {
    animation: scaleIn 0.3s ease-out;
  }

  @keyframes scaleIn {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  .prose p {
    margin-bottom: 1rem;
  }
</style>

<script is:inline>
  // Project data storage
  let projectsData = [];
  let currentProjectImages = [];
  let currentImageIndex = 0;

  // Tech stack icon mapping
  const techIcons = {
    'React': 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/react/react-original.svg',
    'Next.js': 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/nextjs/nextjs-original.svg',
    'TypeScript': 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/typescript/typescript-original.svg',
    'JavaScript': 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/javascript/javascript-original.svg',
    'Node.js': 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/nodejs/nodejs-original.svg',
    'Python': 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/python/python-original.svg',
    'PostgreSQL': 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/postgresql/postgresql-original.svg',
    'MongoDB': 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/mongodb/mongodb-original.svg',
    'Redis': 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/redis/redis-original.svg',
    'Docker': 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/docker/docker-original.svg',
    'Tailwind CSS': 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/tailwindcss/tailwindcss-plain.svg',
    'Express': 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/express/express-original.svg',
    'Kafka': 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/apachekafka/apachekafka-original.svg',
    'C#': 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/csharp/csharp-original.svg',
    'OpenAI': 'https://cdn.simpleicons.org/openai/412991',
    'Anthropic': 'https://cdn.simpleicons.org/anthropic/191919',
    'Langchain': 'https://cdn.simpleicons.org/langchain/1C3C3C',
    'Pinecone': 'https://cdn.simpleicons.org/pinecone/000000',
    'Astro': 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/astro/astro-original.svg',
  };

  // Project image mappings
  const projectImageMappings = {
    'ecommerce-platform': [
      'ecommerce-platform-6.webp',
      'ecommerce-platform-7.webp',
      'home dash.webp',
      'home.webp',
      'itemslist.webp',
      'settings (2).webp',
      'settings page.webp',
      'settings.webp',
      'side panel.webp'
    ],
    'kafka-streaming-dashboard': [
      'data sources.webp',
      'fiscal calendar.webp',
      'home dash 2.webp',
      'home dash.webp',
      'home.webp',
      'kafka (2).webp',
      'kafka pipeline.webp',
      'kafka pipeline2.webp',
      'kafka.webp',
      'products.webp',
      'sales.webp',
      'sales2.webp',
      'streaming service.webp',
      'suppliers.webp'
    ],
    'Nail salon Website': [
      'description.webp',
      'home.webp',
      'products.webp',
      'reviews.webp'
    ],
    'nail-salon-website 2': [
      'book.webp',
      'booking.webp',
      'bookings.webp',
      'home.webp',
      'location.webp',
      'locations.webp',
      'review.webp',
      'reviews.webp'
    ],
    'Recode': [
      'coding_challenge.png',
      'analytics.png',
      'analytics2.png',
      'badges.png',
      'modules.pjng.png',
      'overviewCards.png',
      'overviewTable.png',
      'profile.png'
    ],
    'University Website': [
      'e28jzmcmxt4fz0zrdnfw.webp',
      'kqcsm4c4unwmdmmdpyob.webp',
      'mnakc9omlwhmynwp8ukb.webp',
      'nfxwzoi42eikn4ttcg0t.webp',
      'whbd8cylzblqjumatmje.webp',
      'xxld9u8mcgxsfvvpnemn.webp'
    ]
  };

  function setProjectsData(projects) {
    projectsData = projects;
  }

  function openProjectModal(projectTitle) {
    const project = projectsData.find(p => p.title === projectTitle);
    if (!project) return;

    const modal = document.getElementById('projectModal');
    if (!modal) return;

    // Get images for this project
    const projectKey = Object.keys(projectImageMappings).find(key => 
      project.title.toLowerCase().includes(key.toLowerCase()) || 
      key.toLowerCase().includes(project.title.toLowerCase())
    );
    
    const imageFolder = project.image.substring(0, project.image.lastIndexOf('/'));
    currentProjectImages = projectKey 
      ? projectImageMappings[projectKey].map(img => `${imageFolder}/${img}`)
      : [project.image];
    
    currentImageIndex = 0;

    // Set content
    document.getElementById('modalCategory').textContent = project.category || 'Featured Project';
    document.getElementById('modalTitle').textContent = project.title;
    document.getElementById('modalDescription').textContent = project.description;
    document.getElementById('modalLongDescription').innerHTML = `<p class="text-lg text-slate-300 leading-relaxed">${project.longDescription}</p>`;
    
    // Set main image
    updateMainImage();

    // Build thumbnail gallery
    buildThumbnailGallery();

    // Build tech stack with icons
    const techStackContainer = document.getElementById('modalTechStack');
    techStackContainer.innerHTML = project.tech.map(tech => {
      const iconUrl = techIcons[tech] || null;
      if (iconUrl) {
        return `
          <div class="flex items-center gap-2 px-4 py-2 bg-slate-800/80 border border-slate-700/50 rounded-lg backdrop-blur-sm group hover:border-blue-500/50 transition-all duration-300">
            <img src="${iconUrl}" alt="${tech}" class="w-6 h-6 group-hover:scale-110 transition-transform" />
            <span class="text-sm font-medium text-slate-300">${tech}</span>
          </div>
        `;
      } else {
        return `
          <span class="px-4 py-2 bg-slate-800/80 border border-slate-700/50 text-slate-300 text-sm rounded-lg backdrop-blur-sm hover:border-blue-500/50 transition-all duration-300">
            ${tech}
          </span>
        `;
      }
    }).join('');

    // Build action buttons
    const actionsContainer = document.getElementById('modalActions');
    let actionsHTML = '';
    
    if (project.video) {
      actionsHTML += `
        <button 
          onclick="window.openVideoModal('${project.video}')"
          class="flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-semibold transition-all duration-300 shadow-lg shadow-blue-500/25 hover:shadow-blue-500/40 group"
        >
          <svg class="w-5 h-5 group-hover:scale-110 transition-transform" fill="currentColor" viewBox="0 0 24 24">
            <path d="M8 5v14l11-7z"/>
          </svg>
          <span>Watch Demo</span>
        </button>
      `;
    }
    
    if (project.github) {
      actionsHTML += `
        <a 
          href="${project.github}" 
          target="_blank" 
          rel="noopener noreferrer"
          class="flex items-center gap-2 px-6 py-3 bg-slate-800/50 hover:bg-slate-700/50 border-[0.7px] border-blue-900/60 hover:border-blue-500/50 text-white rounded-xl font-semibold transition-all duration-300 backdrop-blur-sm group"
        >
          <svg class="w-5 h-5 group-hover:scale-110 transition-transform" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
          <span>View on GitHub</span>
        </a>
      `;
    }
    
    if (project.live) {
      actionsHTML += `
        <a 
          href="${project.live}" 
          target="_blank" 
          rel="noopener noreferrer"
          class="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-500 hover:to-cyan-500 text-white rounded-xl font-semibold transition-all duration-300 shadow-lg shadow-blue-500/25 hover:shadow-blue-500/40 group"
        >
          <span>Live Demo</span>
          <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </a>
      `;
    }
    
    actionsContainer.innerHTML = actionsHTML;

    // Show modal
    modal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  }

  function closeProjectModal() {
    const modal = document.getElementById('projectModal');
    if (modal) {
      modal.classList.add('hidden');
      document.body.style.overflow = '';
    }
  }

  function updateMainImage() {
    const mainImage = document.getElementById('modalMainImage');
    const currentIndexEl = document.getElementById('currentImageIndex');
    const totalImagesEl = document.getElementById('totalImages');
    
    if (mainImage && currentProjectImages.length > 0) {
      mainImage.src = currentProjectImages[currentImageIndex];
      mainImage.loading = currentImageIndex === 0 ? 'eager' : 'lazy';
      mainImage.decoding = 'async';
      if (currentIndexEl) currentIndexEl.textContent = currentImageIndex + 1;
      if (totalImagesEl) totalImagesEl.textContent = currentProjectImages.length;
    }
  }

  function buildThumbnailGallery() {
    const gallery = document.getElementById('thumbnailGallery');
    if (!gallery) return;

    gallery.innerHTML = currentProjectImages.map((img, index) => `
      <button 
        onclick="window.setImageIndex(${index})"
        class="aspect-video rounded-lg overflow-hidden border-2 ${index === currentImageIndex ? 'border-blue-500' : 'border-slate-700/50'} hover:border-blue-500/50 transition-all duration-300"
      >
        <img src="${img}" alt="Thumbnail ${index + 1}" class="w-full h-full object-cover" loading="lazy" decoding="async" />
      </button>
    `).join('');
  }

  function setImageIndex(index) {
    currentImageIndex = index;
    updateMainImage();
    buildThumbnailGallery();
  }

  function nextImage() {
    currentImageIndex = (currentImageIndex + 1) % currentProjectImages.length;
    updateMainImage();
    buildThumbnailGallery();
  }

  function prevImage() {
    currentImageIndex = (currentImageIndex - 1 + currentProjectImages.length) % currentProjectImages.length;
    updateMainImage();
    buildThumbnailGallery();
  }

  // Setup event listeners
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initProjectModal);
  } else {
    initProjectModal();
  }

  function initProjectModal() {
    const prevBtn = document.getElementById('prevImageBtn');
    const nextBtn = document.getElementById('nextImageBtn');
    
    if (prevBtn) prevBtn.addEventListener('click', prevImage);
    if (nextBtn) nextBtn.addEventListener('click', nextImage);

    // Close on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeProjectModal();
    });
  }

  // Expose functions to window
  window.openProjectModal = openProjectModal;
  window.closeProjectModal = closeProjectModal;
  window.setProjectsData = setProjectsData;
  window.setImageIndex = setImageIndex;
</script>
